{% extends 'base.html' %}

{% block title %}Live Streams page -  Kumasi Central CoC {% endblock %}

{% block content %} 

 <!-- Page Header -->
 <section data-aos="fade-in" class="relative">
    <img
      src="https://images.unsplash.com/photo-1675977586492-fec42f8d00af?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8bGl2ZSUyMHN0cmVhbXN8ZW58MHx8MHx8fDA%3D"
      alt="Worship and Fellowship"
      class="w-full h-96 object-cover object-center"
    />
    <div class="absolute top-0 left-0 right-0 bottom-0 bg-black opacity-50"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center text-white">
      <h1 class="text-4xl font-bold animate-fade-in">Live Streams</h1>
      <p class="text-xl mt-4 animate-fade-in delay-100">View our live and archieved streams</p>
    </div>
  </section>


  {% load static %}
  <section data-aos="fade-in" class="py-12 md:py-20 bg-gradient-to-b from-gray-50 to-white">
    <div class="max-w-4xl mx-auto px-4 text-center">
     <!-- Heading & Description with Live Badge -->
<div class="text-center mb-8">
  {% if live_stream.is_live %}
    <span class="inline-flex items-center mb-4">
      <!-- Pulsing dot -->
      <span class="relative flex h-6 w-6 mr-2">
        <span class="absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75 animate-ping"></span>
        <span class="relative inline-flex h-6 w-6 rounded-full bg-red-600"></span>
      </span>
      <!-- Live label -->
      <span class="uppercase font-semibold text-lg text-red-600">Live Now</span>
    </span>
  {% endif %}

  <!-- Title -->
  <h1 class="text-2xl md:text-5xl font-bold text-gray-700">
    {{ live_stream.title|default:"Join Us Live Now" }}
  </h1>

  <!-- Description -->
  <p class="text-lg md:text-xl text-gray-600 mt-4">
    {{ live_stream.description|default:"Experience our live service, community worship, and inspiring messages—wherever you are." }}
  </p>
</div>

  
      {% if live_stream %}
        <!-- Live Video Embed -->
        <div class="mx-auto mb-8 w-full sm:w-3/4 lg:w-2/3">
          <div class="fb-video w-full h-full" 
               data-href="{{ live_stream.video_url }}"
               data-width="720" data-allowfullscreen="true">
          </div>
        </div>

         <!-- Social Sharing Links -->
  <div class="mt-12 flex flex-col items-center space-y-4">
    <p class="text-sm font-medium text-gray-500">Share this stream:</p>
    <div class="flex justify-center gap-3">
      <!-- Twitter -->
      <a href="https://twitter.com/intent/tweet?text=Check%20out%20this%20stream%3A%20{{ live_stream.title|urlencode }}%20{{ request.build_absolute_uri|urlencode }}"
         target="_blank" rel="noopener noreferrer"
         class="p-3 rounded-xl bg-gradient-to-br from-blue-400 to-blue-600 hover:from-blue-500 hover:to-blue-700 transition-transform duration-300 transform hover:scale-110 hover:shadow-lg" aria-label="Share on Twitter">
        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24" role="img">
          <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
        </svg>
      </a>
      <!-- Facebook -->
      <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri|urlencode }}"
         target="_blank" rel="noopener noreferrer"
         class="p-3 rounded-xl bg-gradient-to-br from-blue-600 to-blue-800 hover:from-blue-700 hover:to-blue-900 transition-transform duration-300 transform hover:scale-110 hover:shadow-lg" aria-label="Share on Facebook">
        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24" role="img">
          <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
        </svg>
      </a>
      <!-- LinkedIn -->
      <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ request.build_absolute_uri|urlencode }}&title={{ live_stream.title|urlencode }}"
         target="_blank" rel="noopener noreferrer"
         class="p-3 rounded-xl bg-gradient-to-br from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800 transition-transform duration-300 transform hover:scale-110 hover:shadow-lg" aria-label="Share on LinkedIn">
        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24" role="img">
          <path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z"/>
        </svg>
      </a>
      <!-- WhatsApp -->
      <a href="https://api.whatsapp.com/send?text=Check%20out%20this%20stream%3A%20{{ live_stream.title|urlencode }}%20{{ request.build_absolute_uri|urlencode }}"
         target="_blank" rel="noopener noreferrer"
         class="p-3 rounded-xl bg-gradient-to-br from-green-500 to-green-700 hover:from-green-600 hover:to-green-800 transition-transform duration-300 transform hover:scale-110 hover:shadow-lg" aria-label="Share on WhatsApp">
        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24" role="img">
          <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
        </svg>
      </a>
      <!-- Reddit -->
      <a href="https://reddit.com/submit?url={{ request.build_absolute_uri|urlencode }}&title={{ live_stream.title|urlencode }}"
         target="_blank" rel="noopener noreferrer"
         class="p-3 rounded-xl bg-gradient-to-br from-orange-500 to-orange-700 hover:from-orange-600 hover:to-orange-800 transition-transform duration-300 transform hover:scale-110 hover:shadow-lg" aria-label="Share on Reddit">
        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24" role="img">
          <path d="M24 11.779c0-1.459-1.192-2.645-2.657-2.645-.715 0-1.363.29-1.84.756-1.814-1.171-4.274-1.882-6.972-1.992l1.483-4.669 4.016.941-.006.058c0 1.193.973 2.164 2.164 2.164 1.193 0 2.164-.971 2.164-2.164s-.971-2.164-2.164-2.164c-.95 0-1.752.614-2.045 1.466l-4.389-1.029c-.093-.023-.188.022-.224.11l-1.653 5.207c-2.837.096-5.401.788-7.303 1.979-.479-.465-1.127-.756-1.843-.756-1.465 0-2.657 1.187-2.657 2.645 0 1.096.666 2.037 1.614 2.443-.041.287-.062.579-.062.874 0 3.591 4.216 6.509 9.404 6.509s9.404-2.918 9.404-6.509c0-.295-.021-.587-.062-.874.948-.406 1.614-1.347 1.614-2.443zm-16.782 1.871c0-.897.73-1.627 1.627-1.627s1.627.73 1.627 1.627-.73 1.627-1.627 1.627-1.627-.73-1.627-1.627zm8.486 4.792c-1.009.891-2.732 1.355-5.098 1.355-2.365 0-4.088-.464-5.097-1.355-.123-.108-.143-.291-.035-.415.108-.123.29-.143.415-.035.854.754 2.393 1.139 4.717 1.139 2.324 0 3.863-.385 4.717-1.139.124-.108.307-.088.415.035.108.124.088.307-.035.415zm-.399-3.165c-.897 0-1.627-.73-1.627-1.627s.73-1.627 1.627-1.627 1.627.73 1.627 1.627-.73 1.627-1.627 1.627z"/>
        </svg>
      </a>
      <!-- Copy Link -->
      <button onclick="copyToClipboard('{{ request.build_absolute_uri }}', event)"
              class="p-3 rounded-xl bg-gradient-to-br from-gray-600 to-gray-800 hover:from-gray-700 hover:to-gray-900 transition-transform duration-300 transform hover:scale-110 hover:shadow-lg relative focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"
              aria-label="Copy stream link">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" role="img" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
        </svg>
        <span class="absolute -top-8 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-2 py-1 rounded-md text-sm opacity-0 transition-opacity duration-200 pointer-events-none" role="tooltip">
          Copy link
        </span>
      </button>
    </div>
  </div>
     
      {% else %}
        <!-- Fallback When Not Live -->
        <div class="py-12 bg-red-50 rounded-2xl shadow-lg inline-block">
          <div class="flex items-center justify-center mb-4">
            <svg class="w-12 h-12 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M13 16h-1v-4h-1m-2 4h8m4 0a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <h2 class="text-2xl font-bold text-red-700 mb-2">No Live Stream Right Now</h2>
          <p class="text-gray-600 mb-4">Please check back soon for upcoming events and messages.</p>
        </div>
      {% endif %}
    </div>
  </section>



<section data-aos="fade-in" class="py-16 bg-gray-50">
    <div class="max-w-7xl mx-auto px-6 sm:px-8">
      <!-- Section Header -->
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-gray-900">Archived Live Streams</h2>
        <p class="text-lg text-gray-600 mt-2">Explore past live streams and sermons. Stay connected with our community and grow in faith.</p>
      </div>
  
        <!-- Search bar -->
        {% comment %} <div class="flex mb-6">
            <input id="search-input"
                   type="text" name="q"
                   value="{{ query }}"
                   placeholder="Search titles…"
                   class="flex-1 border rounded-l-lg px-4 py-2" />
           
          </div> {% endcomment %}

          <div class="relative flex mb-6">
            <!-- Search Icon (Heroicons) -->
            <span class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg
                class="h-5 w-5 text-gray-400"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                aria-hidden="true"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M11 4a7 7 0 015.292 11.708l4.414 4.414a1 1 0 01-1.414 1.414l-4.414-4.414A7 7 0 1111 4z" />
              </svg>
            </span>
          
            <!-- Text Input -->
            <input
              id="search-input"
              type="text"
              name="q"
              value="{{ query }}"
              placeholder="Search titles…"
              class="w-full
                     pl-10 pr-4 py-2
                     rounded-lg border border-gray-300
                     bg-white text-gray-900 placeholder-gray-500
                     focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent
                     transition-shadow shadow-sm hover:shadow-md"
            />
          </div>
          

      
      <!-- Inject our partial here -->
      <div id="videos-container">
        {% include 'community/partials/_archived_streams_list.html' %}
      </div>
    
    </div>
  </section>


  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const container   = document.getElementById('videos-container');
      const searchInput = document.getElementById('search-input');
    
      function debounce(fn, delay) {
        let timeout;
        return (...args) => {
          clearTimeout(timeout);
          timeout = setTimeout(() => fn.apply(this, args), delay);
        };
      }
    
      async function fetchStreams(page = 1, append = false) {
        const btn     = container.querySelector('#load-more-btn');
        const spinner = btn?.querySelector('.spinner');
        const query   = encodeURIComponent(searchInput.value.trim());
        const url     = `${window.location.pathname}?page=${page}&q=${query}`;
    
        if (btn) {
          btn.disabled = true;
          spinner.classList.remove('hidden');
        }
    
        try {
          const res = await fetch(url, {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
          });
          if (!res.ok) throw new Error(`Status ${res.status}`);
    
          const data = await res.json();
    
          if (append) {
            const frag     = document.createRange().createContextualFragment(data.html);
            const newItems = frag.querySelector('#archived-list').innerHTML;
            container.querySelector('#archived-list')
                     .insertAdjacentHTML('beforeend', newItems);
          } else {
            container.innerHTML = data.html;
          }
    
          // update Load More
          if (data.has_next) {
            const newBtn = container.querySelector('#load-more-btn');
            newBtn.dataset.nextPage = data.next_page;
            newBtn.style.display = 'inline-flex';
            newBtn.disabled = false;
          } else if (btn) {
            btn.style.display = 'none';
          }
    
          // --- <== Re-parse FB plugins here ==>
          if (window.FB && FB.XFBML && typeof FB.XFBML.parse === 'function') {
            FB.XFBML.parse(container);
          }
    
        } catch (err) {
          console.error(err);
          container.insertAdjacentHTML('afterbegin',
            `<p class="text-red-600 text-center my-4">
               Oops! Something went wrong. Please try again later.
             </p>`);
          if (btn) btn.disabled = false;
        } finally {
          if (spinner) spinner.classList.add('hidden');
        }
      }
    
      // Debounced live search:
      const debouncedSearch = debounce(() => fetchStreams(1, false), 300);
      searchInput.addEventListener('input', debouncedSearch);
    
      // Delegate Load‑More:
      container.addEventListener('click', e => {
        const lm = e.target.closest('#load-more-btn');
        if (!lm) return;
        const nextPage = parseInt(lm.dataset.nextPage, 10);
        fetchStreams(nextPage, true);
      });
    
      // Optionally: trigger an initial load on page‑load if you want fresh results
      // fetchStreams(1, false);
    });
    </script>
    

{% endblock %}